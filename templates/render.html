<!DOCTYPE html>
<html lang="en" data-theme="{{ session.get('theme', 'light') }}">
<head>
<meta charset="utf-8">
<title>Email Render</title>

<style>
:root {
  --bg:#ffffff; 
  --text:#222; 
  --link:#1976d2;
}

[data-theme="dark"] {
  --bg:#121212; 
  --text:#eaeaea; 
  --link:#90caf9;
}

html, body {
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 12px;
  overflow-wrap: break-word;
  transition: background 0.25s ease, color 0.25s ease;
}

a {
  color: var(--link);
  text-decoration: underline;
  transition: color 0.25s ease;
}

table, td, th {
  border-collapse: collapse;
  border-color: #ccc;
}
[data-theme="dark"] table, 
[data-theme="dark"] td, 
[data-theme="dark"] th {
  border-color: #444;
}
</style>
</head>

<body>
{{ html_body | safe }}

<script>
// === THEME SYNC SYSTEM FOR IFRAME RENDER ===
(function() {
  const root = document.documentElement;

  function applyTheme(theme) {
    root.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  }

  // Initialize with saved or parent theme
  const saved = localStorage.getItem("theme");
  if (saved) applyTheme(saved);
  else if (window.parent && window.parent.document) {
    try {
      const parentTheme = window.parent.document.documentElement.getAttribute("data-theme");
      if (parentTheme) applyTheme(parentTheme);
    } catch(e){}
  }

  // Listen for themeChanged broadcast (from layout or message)
  window.addEventListener("themeChanged", (ev) => {
    if (ev.detail && ev.detail.theme) applyTheme(ev.detail.theme);
  });

  // Listen for themeSync postMessage (from message.html)
  window.addEventListener("message", (ev) => {
    if (ev.data && ev.data.type === "themeSync") {
      applyTheme(ev.data.theme);
    }
  });

  // LocalStorage sync (multi-tab)
  window.addEventListener("storage", (ev) => {
    if (ev.key === "theme" && ev.newValue) applyTheme(ev.newValue);
  });
})();
</script>

</body>
</html>
